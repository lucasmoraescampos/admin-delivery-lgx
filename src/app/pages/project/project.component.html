<div class="row">

  <div class="col-xl-6" *ngIf="display == 1">

    <app-iq-card [isCardHeader]="false">

      <tabset type="pills" [justified]="true">

        <tab class="animate__animated animate__fadeIn" heading="Drivers ({{ project?.drivers.length || '0' }})">

          <div class="row">

            <div class="col-md-12 text-right mt-3">

              <button type="button" class="btn btn-primary btn-sm" (click)="modalDriver()">

                <i class="ri-add-line"></i>

                Add Drivers

              </button>

            </div>

            <div class="col-md-12 mt-3">

              <table class="table table-hover table-sm m-0">

                <thead class="thead-primary">

                  <tr>

                    <th width="8%"></th>

                    <th width="46%">Name</th>

                    <th width="46%">Start Address</th>

                  </tr>

                </thead>

              </table>

              <div class="table-responsive table-scroll-y">

                <table class="table table-hover table-sm">

                  <tbody>

                    <tr *ngFor="let driver of drivers; let i=index" (click)="driverInfoById(driver.id)">

                      <td width="8%">

                        <input type="checkbox" [checked]="isDriverchecked(driver)"
                          (input)="checkDriver(driver, $event)">

                      </td>

                      <td width="46%">

                        <span>{{ driver.name }}</span>

                      </td>

                      <td width="46%">

                        <span>{{ driver.start_address }}</span>

                      </td>

                    </tr>

                    <tr class="text-center" *ngIf="drivers.length == 0">

                      <td colspan="6">

                        <i class="ri-search-line"></i> No drivers found

                      </td>

                    </tr>

                  </tbody>

                </table>

              </div>

            </div>

          </div>

        </tab>

        <tab class="animate__animated animate__fadeIn" heading="Stops ({{ project?.stops.length || '0' }})">

          <div class="row">

            <div class="col-md-12 mt-3 text-right">

              <button type="button" class="btn btn-primary btn-sm mr-1" (click)="modalStop()">

                <i class="ri-add-line"></i>

                Add Stops

              </button>

              <button type="button" class="btn btn-primary btn-sm" (click)="modalUploadStops()">

                <i class="ri-upload-line"></i>

                Upload a List of Stops

              </button>

            </div>

            <div class="col-md-12 mt-3">

              <table class="table table-hover table-sm m-0">

                <thead class="thead-primary">

                  <tr>

                    <th width="30%">Name</th>

                    <th width="44%">Address</th>

                    <th width="26%">Status</th>

                  </tr>

                </thead>

              </table>

              <div class="table-responsive table-scroll-y">

                <table class="table table-hover table-sm">

                  <tbody>

                    <tr *ngFor="let stop of project?.stops" (click)="stopInfo(stop)">

                      <td width="30%">

                        <span>{{ stop.name }}</span>

                      </td>

                      <td width="45%">

                        <span>{{ stop.address }}</span>

                      </td>

                      <td width="25%">

                        <span class="badge badge-light">Waiting Dispatch</span>

                      </td>

                    </tr>

                    <tr class="text-center" *ngIf="project?.stops.length == 0">

                      <td colspan="3">

                        <i class="ri-search-line"></i> No stops found

                      </td>

                    </tr>

                  </tbody>

                </table>

              </div>

            </div>

          </div>

        </tab>

      </tabset>

    </app-iq-card>

  </div>

  <div [class]="display == 1 ? 'col-xl-6' : 'col-xl-12'" [hidden]="!project">

    <div class="map-header" *ngIf="project?.stops.length > 0 && project?.drivers.length > 0">

      <button class="btn btn-light animate__animated animate__fadeIn" (click)="display = 1" *ngIf="display != 1">

        <i class="ri-menu-line"></i> Drivers And Stops

      </button>

      <button class="btn btn-light animate__animated animate__fadeIn" (click)="display = 0"
        *ngIf="project?.status > 0 && display == 1">

        Continue Routing <i class="ri-arrow-right-line"></i>

      </button>

      <button class="btn btn-light animate__animated animate__fadeIn" (click)="optimize()" *ngIf="project?.status == 0">

        <i class="ri-flashlight-line"></i> Optimize Route

      </button>

      <button class="btn btn-light animate__animated animate__fadeIn" (click)="optimize()"
        *ngIf="project?.status > 0 && display != 1">

        <i class="ri-flashlight-line"></i> Reoptimize Route

      </button>

    </div>

    <div class="map" #map></div>

    <div class="map-footer animate__animated animate__fadeInUp" *ngIf="project?.status > 0 && display != 1">

      <div class="tabs">

        <button class="btn btn-tab" [ngClass]="{ 'btn-dark': tab == 1, 'btn-light': tab == 2 }"
          (click)="tab = 1; display = 2;">TIMELINE</button>

        <button class="btn btn-tab ml-2" [ngClass]="{ 'btn-dark': tab == 2, 'btn-light': tab == 1 }"
          (click)="tab = 2; display = 2;">DISPATCH</button>

      </div>

      <div class="header">

        <span class="title" *ngIf="tab == 1">Plan</span>

        <span class="title" *ngIf="tab == 2">Dispatch Manager</span>

        <div class="text-right">

          <button class="btn btn-dark btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
            aria-expanded="false" *ngIf="tab == 1">

            <i class="ri-download-line"></i> Download

          </button>

          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

            <a class="dropdown-item" href="javascript:void(0);" (click)="downloadSolution()">Solution Download</a>

            <a class="dropdown-item" href="javascript:void(0);" (click)="downloadSummary()">Summary Download</a>

          </div>

          <button class="btn btn-primary btn-sm" *ngIf="tab == 2 && project.status != 2" (click)="dispatch()">

            <i class="ri-send-plane-line"></i> Publish Changes

          </button>

          <button class="btn btn-dark btn-sm" (click)="display = 0" *ngIf="display == 2">

            <i class="ri-arrow-down-s-line"></i> Collapse

          </button>

          <button class="btn btn-dark btn-sm" (click)="display = 2" *ngIf="display == 0">

            <i class="ri-arrow-up-s-line"></i> Expand

          </button>

        </div>

      </div>

      <div class="body table-responsive" *ngIf="display == 2">

        <table class="table" width="100%" *ngIf="tab == 1">

          <thead>

            <th>Driver</th>

            <th>Stops</th>

          </thead>

          <tbody>

            <tr class="unscheduled" *ngIf="unscheduled.length > 0">

              <td width="200px" style="vertical-align: middle;">
                
                <span class="badge badge-light">Unscheduled</span>
              
              </td>

              <td>

                <div style="display: flex;">

                  <ul [sortablejs]="unscheduled_order" [sortablejsOptions]="{ group: { name: 'stops', put: false }, sort: false }">

                    <li *ngFor="let stop of unscheduled; let i=index;">
                      
                      <span class="card" (click)="stopInfoById(stop.id)">{{ i+1 }}</span>
                      
                    </li>

                  </ul>

                </div>

              </td>

            </tr>

            <tr *ngFor="let driver of project?.drivers; let i=index;">

              <td width="200px" style="vertical-align: middle;">{{ driver.name }}</td>

              <td>

                <div class="time">

                  <span>{{ driver.start_time | slice:0:5 }}</span>

                  <span *ngFor="let route of driver.pivot.routes; let i=index;">{{ route.time }}</span>

                </div>

                <div style="display: flex;">

                  <ul>

                    <li>

                      <span class="card" [style.background]="colors[i]" [style.color]="'white'" (click)="driverInfo(driver)">

                        <i class="ri-truck-line"></i>

                      </span>
                    
                    </li>

                  </ul>

                  <ul class="unsortable">

                    <ng-container *ngFor="let route of driver.pivot.routes; let i=index;">

                      <li *ngIf="route.status == 1">
                        
                        <span class="card dispatched" (click)="stopInfoById(route.end_id)">{{ i+1 }}</span>
                      
                      </li>

                      <li *ngIf="route.status == 2">
                      
                        <span class="completed card" (click)="stopInfoById(route.end_id)">{{ i+1 }}</span>
                      
                      </li>

                      <li *ngIf="route.status == 3">
                      
                        <span class="card skipped" (click)="stopInfoById(route.end_id)">{{ i+1 }}</span>
                      
                      </li>

                    </ng-container>

                  </ul>

                  <ul class="sortable" [sortablejs]="driver.pivot.stops_order" [sortablejsOptions]="options" [id]="i">

                    <ng-container *ngFor="let route of driver.pivot.routes; let i=index;">

                      <li *ngIf="route.status == 0">
                        
                        <span class="card" (click)="stopInfoById(route.end_id)">{{ i+1 }}</span>
                        
                      </li>

                    </ng-container>

                  </ul>

                </div>

              </td>

            </tr>

          </tbody>

        </table>

        <table class="table" width="100%" *ngIf="tab == 2">

          <thead>

            <th>Driver</th>

            <th>Stops</th>

            <th>Status</th>

            <th>Phone</th>

            <th *ngIf="project.status == 2"></th>

          </thead>

          <tbody>

            <tr *ngFor="let driver of project?.drivers; let i=index;">

              <td width="200px">{{ driver.name }}</td>

              <td>{{ driver.pivot.stops_order?.length }}</td>

              <td>

                <span class="badge badge-primary" *ngIf="project.status == 1">READY FOR DISPATCH</span>

                <span class="badge badge-dark" *ngIf="project.status == 2">DISPATCHED</span>

              </td>

              <td>{{ driver.phone }}</td>

              <td class="text-right" *ngIf="project.status == 2">

                <button class="btn btn-light btn-sm" ngxClipboard [cbContent]="driverLink(driver.id)"
                  (click)="copyLinkSuccess()">

                  <i class="ri-file-copy-line"></i> Copy link

                </button>

              </td>

            </tr>

          </tbody>

        </table>

      </div>

    </div>

  </div>

</div>